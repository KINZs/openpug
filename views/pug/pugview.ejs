<div class="container">
	<div class="row">
		<div class="col-md-4" id="puginfodiv">
			
			<h4><% if (pug.game == 'csgo' ) { %>
						Counter-Strike: Global Offensive
					<% } %> 
			</h4>

			<p><%= pug.server %> </p>
			<p> Map: <%= pug.map %> </p>
			<p> Config: CEVO</p>		

	
		</div>
		<div class="col-md-4" id="team0div">
			<h5 style="margin-left: auto; margin-right: auto; width: 100%;"> Counter-Terrorists </h5>
			<ul class="list-group" id="ctlist">
				<% for (i = 0; i < pug.maxplayers/2; ++i) { %>
					<% if (typeof pug.players_ct[i] == 'undefined') { %>
						<a class="list-group-item" id="ct<%=i%>">Open Slot</a>
					<% } else { %>
						<a href="https://steamcommunity.com/profiles/<%= pug.players_ct[i].steamid %>" class="list-group-item" id="ct<%=i%>"> <%= pug.players_ct[i].displayName %> </a>
					<% } %>
				<% } %>
			</ul>
			<button type="button" class="btn btn-success" id="joinCT"> Join Counter-Terrorists </button>
		</div>
		<div class="col-md-4" id="team1div">
			<h5 style="margin-left: auto; margin-right: auto; width: 100%;"> Terrorists </h5>
			<ul class="list-group" id="tlist">
				<% for (i = 0; i < pug.maxplayers/2; ++i) { %>
					<% if (typeof pug.players_t[i] == 'undefined') { %>
						<a href="#" class="list-group-item" id="t<%= i %>">Open Slot</a>
					<% } else { %>
						<a href="https://steamcommunity.com/profiles/<%= pug.players_t[i].steamid %>" class="list-group-item" id="t<%= i %>"> <%= pug.players_t[i].displayName %></a>
					<% } %>
				<% } %>
				</ul>
				<button type="button" class="btn btn-success" id="joinT">Join Terrorist</button>
		</div>
	</div>
	<div class="row">
	<div class="col-md-12">
	<h3> Server Status </h3>
		<div class="progress">
			<div id="statusbar" class="progress-bar progress-bar-success progress-bar-striped active" role="progressbar" aria-valuenow="10" aria-valuemin="0" aria-valuemax="100" style="width:100%;" >
				Ready
			</div>
		</div>
	</div>
	</div>
</div>
<script>
$("#joinCT").click(function() {
	io.socket.post("/pug/join", {pugid: <%= pug.id %>, team: 'ct', _csrf: '<%=_csrf%>'}, function(data, jwres) {
	});
});
$("#joinT").click(function() {
	io.socket.post("/pug/join", {pugid: <%= pug.id %>, team: 't', _csrf: '<%=_csrf%>'}, function(data, jwres) {  });
});

// Subscribe to updates about this pug
io.socket.get("/pug/<%= pug.id %>", function(res) {});	
io.socket.on('pug', function(message) {
	console.log(message);
	if (message.id == <%= pug.id %> && message.verb == 'updated') {
		for (i = 0; i < message.data.players_ct.length; ++i) {
			$("#ct"+i).html(message.data.players_ct[i].displayName);
			if (message.data.players_ct[i].connectState == 'connected') {
				$("#ct"+i).removeClass('list-group-item-danger');
				$("#ct"+i).addClass('list-group-item-success');
			} else if (message.data.players_ct[i].connectState == 'disconnected') {
				$("#ct"+i).removeClass('list-group-item-success');
				$("#ct"+i).addClass('list-group-item-danger');
			}
		}
		for (i = 5; i >= message.data.players_ct.length; --i) {
			$("#ct"+i).html("Open Slot");
			$("#ct"+i).removeClass('list-group-item-success');
			$("#ct"+i).removeClass('list-group-item-danger');
		}
		for (i = 0; i < message.data.players_t.length; ++i) {
			$("#t"+i).html(message.data.players_t[i].displayName);
			if (message.data.players_t[i].connectState == 'connected') {
				$("#t"+i).removeClass('list-group-item-danger');
				$("#t"+i).addClass('list-group-item-success');
			} else if (message.data.players_t[i].connectState == 'disconnected') {
				$("#t"+i).removeClass('list-group-item-success');
				$("#t"+i).addClass('list-group-item-danger');
			}
		}
		for (i = 5; i >= message.data.players_t.length; --i) {
			$("#t"+i).html("Open Slot");
			$("#t"+i).removeClass('list-group-item-success');
			$("#t"+i).removeClass('list-group-item-danger');
		}
	}
});
io.socket.get("/user/<%= user.id %>", function(data) { console.log(data); }); 

// Leave pug on window close
window.onbeforeunload = function() {
	io.socket.post("/pug/leave", {pugid: <%= pug.id %>, _csrf: '<%=_csrf%>'}, function(data) { console.log(data); });
}
</script>
